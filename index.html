<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The Fusca Legacy: Edição Interatividade Máxima — v2</title>

  <!-- Fonts & Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />

  <style>
    /* =================================================================== */
    /* THE FUSCA LEGACY — v2: Responsivo + Efeitos (Mobile-First)           */
    /* =================================================================== */

    :root {
      /* Tema claro */
      --bg-color: #f4f4f4;
      --surface-color: #ffffff;
      --text-color: #333333;
      --subtle-text-color: #777777;
      --border-color: #dddddd;
      --accent-color: #0077c2;
      --glow-color: rgba(0, 119, 194, 0.5);
      --font-heading: 'Oswald', sans-serif;
      --font-body: 'Roboto', sans-serif;
    }

    /* Reset */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; }
    body {
      height: 100%; width: 100%; overflow-x: hidden; overflow-y: hidden;
      background: var(--bg-color); color: var(--text-color);
      font-family: var(--font-body);
      -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
    }

    /* === Tela de Ignição === */
    #ignition-screen { position: fixed; z-index: 1000; inset: 0; display:flex; align-items:center; justify-content:center; background: var(--bg-color); transition: opacity .6s ease-out; cursor: pointer; }
    #key-container { text-align: center; }
    #car-key { height: 110px; filter: drop-shadow(0 5px 15px rgba(0,0,0,.3)); animation: key-float 3s infinite ease-in-out; }
    #ignition-screen p { font-family: var(--font-heading); font-size: 1.1rem; letter-spacing: 2px; color: var(--subtle-text-color); margin-top: 10px; }
    @keyframes key-float { 0%,100%{ transform: translateY(0);} 50%{ transform: translateY(-15px);} }

    .hidden { opacity: 0; pointer-events: none; }

    #experience-container { transition: opacity 1s ease-in; }

    /* === Para-brisa (cenário) === */
    #windshield { position: fixed; inset: 0; background: #333 url('https://images.unsplash.com/photo-1533613220915-609f661a2fe1?q=80&w=2070') center/cover; }
    .windshield-view { position: absolute; inset: 0; background-size: cover; background-position: center; transition: opacity 1.5s ease-in-out; opacity: 0; }
    #view-default { opacity: 1; }
    #view-era50 { background-image: url('./imagens/fusca-1.jpg'); filter: grayscale(1) sepia(.3); }
    #view-era70 { background-image: url('./imagens/fusca.jpeg'); filter: saturate(1.5); }
    #view-era90 { background-image: url('./imagens/fundo-policia.jpg'); }

    /* === Painel / Dashboard === */
    #dashboard { position: fixed; left:0; right:0; bottom:0; background: linear-gradient(to top, var(--surface-color), #e8e8e8); border-top:1px solid var(--border-color); box-shadow: 0 -5px 20px rgba(0,0,0,.1); padding: 10px; display:flex; flex-direction: column; z-index: 50; }

    /* Agrupador de instrumentos */
    .instrument-cluster { display:grid; grid-template-columns: 1fr 1fr; gap:10px; width: 100%; margin-bottom:10px; }
    .panel-instrument { padding:10px; background: var(--surface-color); border:1px solid var(--border-color); border-radius:10px; box-shadow: 0 5px 15px rgba(0,0,0,.05); text-align:center; position: relative; }
    .instrument-title { font-size:.75rem; letter-spacing:1px; color: var(--subtle-text-color); margin-bottom:6px; font-family: var(--font-heading); }
    #hodometer-display, #radio-display { font-size:1.2rem; }

    #radio-buttons { display:flex; justify-content:center; gap:6px; margin-top:6px; }
    .radio-btn { padding:8px; font-size:.85rem; border: 1px solid #ccc; border-radius:6px; background:#e0e0e0; color:#555; cursor:pointer; transition: all .1s ease-in-out; box-shadow:0 3px 0 #bbb, 0 4px 5px rgba(0,0,0,.1); }
    .radio-btn:active, .radio-btn.active { transform: translateY(2px); box-shadow:0 1px 0 #bbb; }
    .radio-btn.active { background: var(--accent-color); color:#fff; border-color: var(--accent-color); }

    #glove-box-handle, #headlight-btn { height: 44px; font-size:1.2rem; background-image: linear-gradient(to top, #cccccc, #ffffff, #cccccc); border:1px solid #bbb; border-radius:6px; color:#333; cursor:pointer; transition: all .1s; box-shadow: 0 3px 0 #aaa, 0 4px 5px rgba(0,0,0,.1); }
    #glove-box-handle:active, #headlight-btn:active { transform: translateY(2px); box-shadow: 0 1px 0 #aaa; }
    #headlight-btn.active { color: var(--accent-color); box-shadow: 0 1px 0 #aaa, inset 0 0 12px var(--glow-color); }
    body.night-mode #radio-display { color: var(--accent-color); text-shadow: 0 0 10px var(--glow-color); }

    #ficha-btn { display:inline-block; width:100%; margin:6px 0; padding:12px 20px; font-size:1rem; font-family: var(--font-heading); text-decoration:none; color: var(--text-color); background: rgba(255,255,255,.2); border:1px solid rgba(255,255,255,.4); backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); border-radius:30px; cursor:pointer; box-shadow:0 4px 10px rgba(0,0,0,.2); transition: all .3s ease; }
    #ficha-btn:hover { background: rgba(255,255,255,.3); transform: translateY(-2px); box-shadow:0 6px 15px rgba(0,0,0,.3); }
    #ficha-btn:active { background: rgba(255,255,255,.2); transform: translateY(1px); box-shadow:0 3px 8px rgba(0,0,0,.2); }

    #logbook-trigger, #explore-museum-btn { position:relative; width:100%; margin:6px 0; padding:12px; font-size:1rem; border-radius:50px; cursor:pointer; border:1px solid var(--accent-color); }
    #logbook-trigger { background: var(--surface-color); color: var(--accent-color); }
    #explore-museum-btn { background: var(--accent-color); color:#fff; }

    #steering-wheel { display:none; }

    /* Sobreposição de conteúdo das eras */
    #content-overlay { position: fixed; top:10%; left:50%; transform: translateX(-50%); width: 90%; max-width: 640px; padding:20px; background: rgba(255,255,255,.5); border:1px solid #ddd; border-radius:10px; backdrop-filter: blur(6px); z-index: 20; }
    .era-content { transition: opacity .5s; opacity:0; display:none; }
    .era-content.visible { display:block; opacity:1; }
    .era-content h2 { color: var(--accent-color); margin-bottom:10px; font-family: var(--font-heading); }
    .era-content p { font-weight:300; line-height:1.6; }

    /* === Museu === */
    #museum { background: var(--surface-color); color: var(--text-color); transition: opacity 1s ease-in; }
    .museum-intro { height: 70vh; display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center; background-color: var(--bg-color); }
    .museum-intro h1 { font-size: clamp(2rem, 10vw, 3.5rem); font-family: var(--font-heading); }
    .museum-section { padding: 80px 5%; }
    .museum-section h2 { font-size: clamp(1.8rem, 8vw, 3rem); margin-bottom: 40px; font-family: var(--font-heading); text-align:center; text-transform: uppercase; }

    .card-grid { display:grid; grid-template-columns: 1fr; gap:30px; perspective: 1000px; }
    .story-card { aspect-ratio: 3/4; }
    .card-inner { position:relative; width:100%; height:100%; border-radius: 20px; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,.1); transform-style: preserve-3d; transition: transform .8s, box-shadow .8s; }
    .card-bg { position:absolute; inset: -20px; background-size: cover; background-position: center; transform: translateZ(0); transition: transform .8s, filter .5s; filter: grayscale(40%); }
    .card-content { position:absolute; left:0; right:0; bottom:0; padding:30px; background: linear-gradient(to top, rgba(0,0,0,.9) 20%, transparent); transform: translateZ(50px); }
    .card-content h3 { color:#fff; font-family: var(--font-heading); font-size:1.5rem; }
    .card-details-btn { position:absolute; top:20px; right:20px; width:40px; height:40px; border-radius:50%; background: var(--accent-color); color:#fff; border:none; font-size:2rem; line-height:40px; cursor:pointer; transform: translateZ(60px); animation: pulse-light 2.5s infinite; }
    @keyframes pulse-light { 0%,100%{ box-shadow:0 0 10px var(--glow-color);} 50%{ box-shadow:0 0 25px var(--glow-color);} }

    .engine-container { position:relative; max-width: 800px; margin: 0 auto; }
    .engine-image { width:100%; }
    .hotspot { position:absolute; width:30px; height:30px; border-radius:50%; cursor:pointer; background: var(--accent-color); animation: pulse-hotspot 2s infinite; }
    .hotspot::before { content:'+'; color:#fff; font-size: 24px; font-weight:700; position:absolute; top:50%; left:50%; transform: translate(-50%, -52%); }
    @keyframes pulse-hotspot { 0%{ box-shadow:0 0 0 0 var(--glow-color);} 70%{ box-shadow:0 0 0 15px rgba(0,119,194,0);} 100%{ box-shadow:0 0 0 0 rgba(0,119,194,0);} }

    .world-map-container { position:relative; max-width: 900px; margin: 0 auto; }
    .map-image { width:100%; filter: invert(0.1); }
    .map-marker { position:absolute; cursor:pointer; }
    .map-marker::after { content:''; position:absolute; width:20px; height:20px; background: var(--accent-color); border-radius:50%; border:3px solid var(--glow-color); animation: pulse-hotspot 2s infinite; }
    .map-marker span { position:absolute; bottom:30px; left:50%; transform: translateX(-50%); background:#fff; color:#333; padding:5px 10px; border-radius:5px; white-space:nowrap; opacity:0; transition: opacity .3s; box-shadow: 0 2px 5px rgba(0,0,0,.2); }
    .map-marker:hover span { opacity:1; }

    .museum-footer { text-align:center; padding: 50px; background:#e0e0e0; color:#555; }

    /* === Modais === */
    .modal { position: fixed; z-index: 1200; inset: 0; background: rgba(255,255,255,.7); backdrop-filter: blur(5px); display:flex; justify-content:center; align-items:center; transition: opacity .3s; }
    .modal-content, .lightbox-content { background: var(--surface-color); box-shadow: 0 10px 50px rgba(0,0,0,.2); border:1px solid var(--border-color); color: var(--text-color); border-radius:10px; position: relative; width: 90%; max-width: 520px; padding: 24px; }
    .close-button { position:absolute; top:10px; right:20px; font-size: 2rem; color: var(--subtle-text-color); cursor:pointer; }

    .lightbox-content { display:flex; flex-direction:column; max-width: 900px; padding:0; }
    #lightbox-img { max-height: 40vh; width: 100%; object-fit: cover; border-top-left-radius:10px; border-top-right-radius:10px; }
    .lightbox-text { padding: 30px; }
    .lightbox-text h3 { color: var(--accent-color); font-family: var(--font-heading); }

    /* === Efeitos Visuais Novos (luzes/partículas/canvas) === */
    .light-bulb { width:18px; height:18px; border-radius:50%; display:inline-block; margin: 5px; opacity:.2; transition: opacity .3s, box-shadow .3s; }
    .light-bulb.red{ background:#ff2b2b;} .light-bulb.yellow{ background:#ff0;} .light-bulb.green{ background:#0f0;}
    .light-bulb.on { opacity:1; box-shadow: 0 0 12px 5px rgba(255,255,200,.8); }

    .panel-glow { animation: dashGlow 1.5s ease-out forwards; }
    @keyframes dashGlow { from{ box-shadow:0 0 0 transparent;} to{ box-shadow: 0 -5px 40px rgba(255,255,200,.7);} }

    body.night-mode {
      --bg-color:#0b0b0b; --surface-color:#1b1b1b; --text-color:#f5f5f5; --accent-color:#00bcd4;
      background: radial-gradient(circle at 20% 20%, #202020, #000); color: var(--text-color);
    }
    .headlight-flash { position:fixed; inset:0; background: radial-gradient(circle, rgba(255,255,200,.7) 0%, transparent 70%); animation: flash .8s ease-out forwards; pointer-events: none; z-index: 900; }
    @keyframes flash { 0%{ opacity:1;} 100%{ opacity:0;} }

    /* === Canvas dos instrumentos === */
    #speedometer, #tachometer { position: fixed; z-index: 60; width: 80px; height: 80px; }
    #speedometer { bottom: 350px; right: 28px; }
    #tachometer  { bottom: 350px; left: 28px; }

    /* === Ajustes Desktop === */
    @media (min-width: 650px) {
      body { overflow-y:auto; }
      #dashboard { height: 460px; flex-direction: row; justify-content:center; align-items:center; padding: 0; }
      #steering-wheel { display:block; position:absolute; bottom:100px; left:50%; transform: translateX(-50%); width:300px; height:350px; z-index: 10; }
      .instrument-cluster { display:flex; justify-content:space-between; width:100%; max-width: 1200px; padding:0 20px; gap:20px; margin:0; }
      .panel-instrument { flex-grow:1; max-width: 300px; padding: 15px; }
      #hodometer-display, #radio-display { font-size:1.5rem; }
      .radio-btn { padding:10px; font-size:1rem; }
      #glove-box-handle, #headlight-btn { height: 50px; font-size:1.5rem; }
      #logbook-trigger { position: fixed; width: auto; bottom: 270px; right: 30px; padding: 10px 15px; }
      #explore-museum-btn { position: fixed; width: auto; bottom: 270px; left: 50%; transform: translateX(-50%); padding: 15px 30px; font-size: 1.2rem; }
      #ficha-btn { position: fixed; width: auto; bottom: 270px; left: 30px; padding: 10px 15px; }
      .card-grid { grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); }
      .story-card:hover .card-bg { transform: translateZ(0) scale(1.1); filter: grayscale(0%); }
      .lightbox-content { flex-direction: row; }
      #lightbox-img { max-height: 70vh; flex-basis: 60%; }
      .lightbox-text { flex-basis: 40%; }
    }
  </style>
</head>
<body>
  <!-- === IGNITION SCREEN === -->
  <div id="ignition-screen">
    <div id="key-container">
      <img src="./imagens/CHAVE.png" alt="Chave do Carro" id="car-key" />
      <p>Gire a chave para começar.</p>
    </div>
  </div>
  <!-- Dica: havia uma string solta de áudio na versão anterior; removida para evitar layout estranho. -->

  <!-- === EXPERIÊNCIA DO PAINEL === -->
  <div id="experience-container" class="hidden">
    <div id="windshield">
      <div class="windshield-view" id="view-default"></div>
      <div class="windshield-view" id="view-era50"></div>
      <div class="windshield-view" id="view-era70"></div>
      <div class="windshield-view" id="view-era90"></div>
    </div>

    <div id="dashboard">
      <!-- LEDs do painel serão injetados via JS -->

      <div id="steering-wheel">
        <img src="./imagens/volante.png" alt="Volante" width="300" />
        <button id="horn-btn" aria-label="Buzina" style="position:absolute;top:45%;left:45%;width:48px;height:48px;border-radius:50%;border:none;background: rgba(0,0,0,.35);cursor:pointer;"></button>
      </div>

      <div class="instrument-cluster">
        <div id="radio" class="panel-instrument">
          <div class="instrument-title">RÁDIO</div>
          <div id="radio-display">FM <span id="station-display">--.--</span></div>
          <div id="radio-buttons">
            <button class="radio-btn" data-era="era50" data-station="59.0"><span>50's</span></button>
            <button class="radio-btn" data-era="era70" data-station="75.0"><span>70's</span></button>
            <button class="radio-btn" data-era="era90" data-station="93.0"><span>90's</span></button>
          </div>
        </div>

        <div id="glove-box" class="panel-instrument">
          <div class="instrument-title">PORTA-LUVAS</div>
          <button id="glove-box-handle" aria-label="Abrir Porta-Luvas"><i class="fa-solid fa-car-side"></i></button>
        </div>

        <div id="hodometer" class="panel-instrument">
          <div class="instrument-title">HODÔMETRO</div>
          <div id="hodometer-display">0000</div>
          <span>km</span>
        </div>

        <div id="headlight-switch" class="panel-instrument">
          <div class="instrument-title">FARÓIS</div>
          <button id="headlight-btn" aria-label="Acender Faróis"><i class="fa-solid fa-lightbulb"></i></button>
        </div>
      </div>

      <a id="ficha-btn" href="ficha_tecnica.html">Ficha Técnica</a>
      <button id="explore-museum-btn" class="hidden"><i class="fa-solid fa-archway"></i> Explorar o Museu</button>
    </div>

    <div id="content-overlay">
      <div class="era-content" id="era50-content">
        <h2>Anos Dourados (50/60)</h2>
        <p>O Fusca chega ao Brasil, conquista as ruas e se torna um símbolo de modernidade e acesso. A produção nacional em São Bernardo do Campo solidifica seu lugar no coração do país.</p>
      </div>
      <div class="era-content" id="era70-content">
        <h2>Era Pop (70/80)</h2>
        <p>No auge de sua popularidade, o "Fuscão" é uma estrela. Personalizado por jovens e imortalizado no cinema por "Herbie", ele era a cara da liberdade e da cultura pop vibrante da época.</p>
      </div>
      <div class="era-content" id="era90-content">
        <h2>O Legado (90+)</h2>
        <p>Após uma breve despedida, ele retorna como o "Fusca Itamar", um clássico renascido. Mesmo após o fim de sua produção, o mito vive, mais forte do que nunca, em clubes e garagens de colecionadores.</p>
      </div>
    </div>

    <div id="logbook-trigger" class="hidden"><i class="fa-solid fa-book-journal-whills"></i> <span>Diário de Bordo</span></div>
  </div>

  <!-- === MUSEU === -->
  <main id="museum" class="hidden">
    <section class="museum-intro">
      <h1>Bem-vindo ao Museu do Legado</h1>
      <p>Você chegou. Agora, explore as alas que contam a história de uma lenda automotiva.</p>
    </section>

    <section class="museum-section" id="legends-hall">
      <h2 data-aos="fade-up">Hall das Lendas</h2>
      <div class="card-grid">
        <div class="story-card" data-aos="fade-up" data-title="A Estrela de Hollywood" data-text="Herbie, o 'Fusca de corrida', conquistou corações em 'Se Meu Fusca Falasse', provando que o carisma do carro ia muito além das ruas." data-img="https://cdn.motor1.com/images/mgl/zxxAV/s3/herbie-the-love-bug-1963-volkswagen-beetle.jpg">
          <div class="card-inner">
            <div class="card-bg" style="background-image: url('./imagens/fusca-1.jpg')"></div>
            <div class="card-content"><h3>A Estrela de Hollywood</h3><button class="card-details-btn">+</button></div>
          </div>
        </div>
        <div class="story-card" data-aos="fade-up" data-aos-delay="100" data-title="O Rei do Deserto" data-text="Modificado para corridas off-road, o 'Baja Bug' mostrou a incrível versatilidade e robustez do chassi Fusca nos terrenos mais difíceis." data-img="https://i.ytimg.com/vi/u4_813uTAFA/maxresdefault.jpg">
          <div class="card-inner">
            <div class="card-bg" style="background-image: url('./imagens/fundo-policia.jpg')"></div>
            <div class="card-content"><h3>O Rei do Deserto</h3><button class="card-details-btn">+</button></div>
          </div>
        </div>
        <div class="story-card" data-aos="fade-up" data-aos-delay="200" data-title="A Despedida Final" data-text="A 'Última Edición', produzida no México em 2003, marcou o fim de uma era com um modelo nostálgico que celebrava sua longa história." data-img="https://quatrorodas.abril.com.br/wp-content/uploads/2020/08/QR-719-fusca-ultima-edicion-11-e1678122826760.jpg?quality=70&strip=info">
          <div class="card-inner">
            <div class="card-bg" style="background-image: url('./imagens/fusca.jpeg?quality=70&strip=info')"></div>
            <div class="card-content"><h3>A Despedida Final</h3><button class="card-details-btn">+</button></div>
          </div>
        </div>
      </div>
    </section>

    <section class="museum-section" id="engine-bay">
      <h2 data-aos="fade-up">Coração Valente: O Motor Boxer</h2>
      <div class="engine-container" data-aos="zoom-in">
        <img src="https://i.pinimg.com/originals/de/69/2b/de692b1a8ac730b9d5f75e1140502157.png" alt="Motor do Fusca" class="engine-image"/>
        <div class="hotspot" style="top:45%;left:48%" data-title="Carburador" data-text="A peça responsável pela mistura de ar e combustível. A simplicidade do carburador do Fusca era uma de suas maiores virtudes."></div>
        <div class="hotspot" style="top:20%;left:55%" data-title="Ventoinha (A 'Capela')" data-text="Essencial para a refrigeração a ar. Puxava o ar frio para resfriar as aletas do motor, garantindo seu funcionamento em qualquer clima."></div>
        <div class="hotspot" style="top:55%;left:25%" data-title="Dínamo/Alternador" data-text="Gerava a energia elétrica para a bateria e todo o sistema do carro. Um componente robusto e de fácil manutenção."></div>
      </div>
    </section>

    <section class="museum-section" id="world-map">
      <h2 data-aos="fade-up">Um Ícone Global</h2>
      <div class="world-map-container" data-aos="zoom-in">
        <img src="https://svgsilh.com/svg/306338.svg" alt="Mapa do Mundo" class="map-image"/>
        <div class="map-marker" style="top:35%;left:48%" data-country="germany"><span>Alemanha</span></div>
        <div class="map-marker" style="top:68%;left:35%" data-country="brazil"><span>Brasil</span></div>
        <div class="map-marker" style="top:48%;left:18%" data-country="mexico"><span>México</span></div>
      </div>
    </section>

    <footer class="museum-footer"><p>A jornada nunca termina. O Legado continua.</p></footer>
  </main>

  <!-- === Modais completos (corrigidos) === -->
  <div id="fun-fact-modal" class="modal hidden">
    <div class="modal-content">
      <span class="close-button" data-close>&times;</span>
      <h3>Curiosidade</h3>
      <p id="fun-fact-text">...</p>
    </div>
  </div>

  <div id="logbook-modal" class="modal hidden">
    <div class="modal-content">
      <span class="close-button" data-close>&times;</span>
      <h3>Diário de Bordo</h3>
      <ul id="logbook-summary" style="margin-top:10px; line-height:1.8;"></ul>
    </div>
  </div>

  <div id="map-modal" class="modal hidden">
    <div class="modal-content">
      <span class="close-button" data-close>&times;</span>
      <h3 id="map-modal-title">País</h3>
      <p id="map-modal-text">Descrição...</p>
    </div>
  </div>

  <div id="lightbox-modal" class="modal hidden">
    <div class="lightbox-content">
      <span class="close-button" data-close>&times;</span>
      <img id="lightbox-img" src="" alt="Imagem em destaque" />
      <div class="lightbox-text">
        <h3 id="lightbox-title"></h3>
        <p id="lightbox-p"></p>
      </div>
    </div>
  </div>

  <!-- === Instrumentos (Canvas) === -->
  <canvas id="speedometer" width="250" height="250"></canvas>
  <canvas id="tachometer"  width="250" height="250"></canvas>

  <!-- === Áudio === -->
  <audio id="sound-engine-start" src="./sond/car-engine-30745.mp3" preload="auto"></audio>
  <audio id="sound-engine-stop"  src="https://www.myinstants.com/media/sounds/car-engine-shut-off.mp3" preload="auto"></audio>
  <audio id="sound-door-open"   src="https://www.myinstants.com/media/sounds/car-door-open-sound-effect.mp3" preload="auto"></audio>
  <audio id="sound-click"       src="https://www.myinstants.com/media/sounds/mouse-click-153941.mp3" preload="auto"></audio>
  <audio id="sound-horn"        src="https://www.myinstants.com/media/sounds/car-horn-sound-effect-hd.mp3" preload="auto"></audio>
  <audio id="music-era50"       src="./sond/punk-rock-guitar-loop-278767.mp3" loop preload="auto"></audio>
  <audio id="music-era70"       src="./sond/heavy-metal-rock-riff-135795.mp3" loop preload="auto"></audio>
  <audio id="music-era90"       src="./sond/rock-of-joy-197159.mp3" loop preload="auto"></audio>
  <!-- Novo áudio de motor contínuo -->
  <audio id="engine-sound"      src="https://www.soundjay.com/mechanical/sounds/car-engine-1.mp3" loop preload="auto"></audio>

  <!-- Lib AOS -->
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    // === SELETORES ===
    const body = document.body;
    const ignitionScreen = document.getElementById('ignition-screen');
    const experienceContainer = document.getElementById('experience-container');
    const carKey = document.getElementById('car-key');
    const radioButtons = document.querySelectorAll('.radio-btn');
    const stationDisplay = document.getElementById('station-display');
    const gloveBoxHandle = document.getElementById('glove-box-handle');
    const funFactModal = document.getElementById('fun-fact-modal');
    const funFactText = document.getElementById('fun-fact-text');
    const hodometerDisplay = document.getElementById('hodometer-display');
    const logbookTrigger = document.getElementById('logbook-trigger');
    const logbookModal = document.getElementById('logbook-modal');
    const logbookSummary = document.getElementById('logbook-summary');
    const exploreMuseumBtn = document.getElementById('explore-museum-btn');
    const museumSection = document.getElementById('museum');
    const hornBtn = document.getElementById('horn-btn');
    const headlightBtn = document.getElementById('headlight-btn');
    const lightboxModal = document.getElementById('lightbox-modal');
    const lightboxImg = document.getElementById('lightbox-img');
    const lightboxTitle = document.getElementById('lightbox-title');
    const lightboxP = document.getElementById('lightbox-p');
    const storyCards = document.querySelectorAll('.story-card');
    const engineHotspots = document.querySelectorAll('.hotspot');
    const mapMarkers = document.querySelectorAll('.map-marker');
    const mapModal = document.getElementById('map-modal');
    const mapModalTitle = document.getElementById('map-modal-title');
    const mapModalText = document.getElementById('map-modal-text');

    // === AUDIO ===
    const sounds = {
      engineStart: document.getElementById('sound-engine-start'),
      engineStop: document.getElementById('sound-engine-stop'),
      doorOpen: document.getElementById('sound-door-open'),
      click: document.getElementById('sound-click'),
      horn: document.getElementById('sound-horn'),
      engineLoop: document.getElementById('engine-sound')
    };
    const music = {
      era50: document.getElementById('music-era50'),
      era70: document.getElementById('music-era70'),
      era90: document.getElementById('music-era90')
    };

    // === ESTADO ===
    const state = {
      currentEra: null,
      visitedEras: new Set(),
      hodometer: 0,
      totalEras: radioButtons.length,
      lightsOn: false,
      accelerating: false,
      speed: 0,   // 0..180
      rpm: 0      // 0..8000 approx
    };

    const funFacts = [
      'O design do Fusca foi inspirado em um besouro, pensado para eficiência aerodinâmica.',
      'Mais de 21 milhões de unidades do Fusca original foram produzidas.',
      "No México, o Fusca ('Vocho') foi usado como táxi oficial por décadas.",
      "O último Fusca 'clássico' foi produzido no México em 2003.",
      'O motor traseiro refrigerado a ar era robusto e funcionava em qualquer clima.'
    ];
    const countryData = {
      germany: { title: 'Alemanha: O Berço', text: "Onde tudo começou. Conhecido como 'Käfer', projetado por Ferdinand Porsche, símbolo da reconstrução do pós-guerra." },
      brazil:  { title: 'Brasil: A Segunda Casa', text: "Chamado de 'Fusca', foi o carro mais vendido por 24 anos. Robusto e simples para as estradas do país." },
      mexico:  { title: 'México: O Guerreiro', text: "O 'Vocho' serviu como táxi por décadas na Cidade do México. Último país a encerrar a produção (2003)." }
    };

    // === Utilitários ===
    function playSound(audio) {
      if (!audio) return; audio.currentTime = 0; audio.play().catch(()=>{});
    }

    // === Luzes, partículas e modos ===
    function toggleLightMode() {
      state.lightsOn = !state.lightsOn;
      body.classList.toggle('night-mode');
      headlightBtn.classList.toggle('active');
      document.querySelectorAll('.light-bulb').forEach(b => b.classList.toggle('on'));
      const fx = document.createElement('div');
      fx.className = 'headlight-flash';
      document.body.appendChild(fx);
      setTimeout(()=>fx.remove(), 900);
    }

    function createLightParticles() {
      const canvas = document.createElement('canvas');
      canvas.id = 'lightCanvas'; canvas.style.position = 'fixed'; canvas.style.inset = '0'; canvas.style.pointerEvents = 'none'; canvas.style.zIndex = '5';
      canvas.width = window.innerWidth; canvas.height = window.innerHeight; document.body.appendChild(canvas);
      const ctx = canvas.getContext('2d');
      const particles = Array.from({length: 60}).map(()=> ({
        x: Math.random()*canvas.width,
        y: Math.random()*canvas.height,
        r: Math.random()*2 + 1,
        dx: (Math.random()-0.5)*0.5,
        dy: (Math.random()-0.5)*0.5,
        a: Math.random()*0.5 + 0.2
      }));
      function animate(){
        ctx.clearRect(0,0,canvas.width,canvas.height);
        particles.forEach(p=>{ ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fillStyle = `rgba(255,255,200,${p.a})`; ctx.fill(); p.x+=p.dx; p.y+=p.dy; if(p.x<0||p.x>canvas.width) p.dx*=-1; if(p.y<0||p.y>canvas.height) p.dy*=-1; });
        requestAnimationFrame(animate);
      }
      animate();
      window.addEventListener('resize', ()=>{ canvas.width = innerWidth; canvas.height = innerHeight; });
    }

    // === Sequência de Partida ===
    function startExperience(){
      playSound(sounds.engineStart);
      ignitionScreen.classList.add('hidden');
      setTimeout(()=>{
        ignitionScreen.style.display='none';
        experienceContainer.classList.remove('hidden');
        document.getElementById('dashboard').classList.add('panel-glow');
        // LEDS do painel
        const bulbsHTML = `<div class="light-bulb red"></div><div class="light-bulb yellow"></div><div class="light-bulb green"></div>`;
        document.getElementById('dashboard').insertAdjacentHTML('afterbegin', bulbsHTML);
        createLightParticles();
        // motor loop
        const loop = sounds.engineLoop; loop.volume = 0.32; loop.play().catch(()=>{});
        requestAnimationFrame(engineAnimationLoop);
      }, 600);
    }

    // === Alternar Eras ===
    function changeEra(era){
      if (state.currentEra === era) return;
      playSound(sounds.click);
      Object.values(music).forEach(m=>m.pause());
      if (state.currentEra){
        document.getElementById(`${state.currentEra}-content`).classList.remove('visible');
        document.getElementById(`view-${state.currentEra}`).style.opacity = 0;
      }
      state.currentEra = era; state.visitedEras.add(era);
      document.getElementById(`${era}-content`).classList.add('visible');
      document.getElementById(`view-${era}`).style.opacity = 1;
      if (music[era]) { music[era].currentTime = 0; music[era].play().catch(()=>{}); }
      radioButtons.forEach(btn=>{
        btn.classList.toggle('active', btn.dataset.era === era);
        if (btn.dataset.era === era) stationDisplay.textContent = btn.dataset.station;
      });
      updateHodometer(150);
      checkLogbookUnlock();
    }

    function showFunFact(){
      playSound(sounds.click);
      funFactText.textContent = funFacts[(Math.random()*funFacts.length)|0];
      funFactModal.classList.remove('hidden');
      updateHodometer(50);
    }

    function updateHodometer(km){ state.hodometer += km; hodometerDisplay.textContent = String(state.hodometer).padStart(4,'0'); }

    function checkLogbookUnlock(){ if (state.visitedEras.size === state.totalEras){ logbookTrigger.classList.remove('hidden'); exploreMuseumBtn.classList.remove('hidden'); } }

    function showLogbook(){
      playSound(sounds.click);
      logbookSummary.innerHTML = '';
      state.visitedEras.forEach(era=>{
        const eraName = document.querySelector(`[data-era=${era}]`).textContent;
        const li = document.createElement('li'); li.innerHTML = `<i class="fa-solid fa-road"></i> Você viajou pela era dos <strong>${eraName}</strong>.`;
        logbookSummary.appendChild(li);
      });
      logbookModal.classList.remove('hidden');
    }

    function transitionToMuseum(){
      playSound(sounds.engineStop);
      if (state.currentEra && music[state.currentEra]) music[state.currentEra].pause();
      experienceContainer.style.transition = 'opacity .5s ease-out';
      experienceContainer.classList.add('hidden');
      setTimeout(()=>{
        playSound(sounds.doorOpen); body.style.overflowY='auto'; museumSection.classList.remove('hidden'); AOS.init({ duration: 800, once: true, offset: 100 }); museumSection.scrollIntoView({ behavior:'smooth' });
      }, 500);
    }

    function showMapInfo(e){ const data = countryData[e.currentTarget.dataset.country]; if(!data) return; playSound(sounds.click); mapModalTitle.textContent = data.title; mapModalText.textContent = data.text; mapModal.classList.remove('hidden'); }

    function showLightbox(title, text, imgSrc){ playSound(sounds.click); lightboxTitle.textContent = title; lightboxP.textContent = text; lightboxImg.src = imgSrc; lightboxModal.classList.remove('hidden'); }

    function closeModal(){ playSound(sounds.click); document.querySelectorAll('.modal').forEach(m=>m.classList.add('hidden')); }

    // === Canvas: Velocímetro & Conta-Giros ===
    const spdCanvas = document.getElementById('speedometer');
    const rpmCanvas = document.getElementById('tachometer');
    const spdCtx = spdCanvas.getContext('2d');
    const rpmCtx = rpmCanvas.getContext('2d');

    function drawGauge(ctx, value, maxValue, label, lights){
      const w = ctx.canvas.width, h = ctx.canvas.height, r = w/2; ctx.clearRect(0,0,w,h); ctx.save(); ctx.translate(r, r);
      // base
      ctx.beginPath(); ctx.arc(0,0,r-10,0,Math.PI*2); ctx.fillStyle = lights ? '#111' : '#fff'; ctx.fill(); ctx.lineWidth = 5; ctx.strokeStyle = lights ? '#00bcd4' : '#555'; ctx.stroke();
      // marcas (ticks)
      ctx.save(); ctx.rotate(-Math.PI*0.75); const steps = 10; for(let i=0;i<=steps;i++){ ctx.beginPath(); ctx.moveTo(r-32,0); ctx.lineTo(r-16,0); ctx.lineWidth = i%5===0?4:2; ctx.strokeStyle = lights ? '#8be9ff' : '#999'; ctx.stroke(); ctx.rotate((Math.PI*1.5)/steps); } ctx.restore();
      // rótulo
      ctx.fillStyle = lights ? '#00bcd4' : '#333'; ctx.font = 'bold 16px Oswald'; ctx.textAlign='center'; ctx.fillText(label, 0, 68);
      // valor
      ctx.font = 'bold 22px Oswald'; ctx.fillText(value.toFixed(0), 0, 46);
      // ponteiro
      const angle = (Math.PI*0.75) + (Math.min(value, maxValue) / maxValue) * (Math.PI*1.5);
      ctx.rotate(angle); ctx.beginPath(); ctx.moveTo(-10,0); ctx.lineTo(r-40,0); ctx.lineWidth=5; ctx.strokeStyle = lights ? '#0ff' : '#d00'; ctx.stroke(); ctx.restore();
    }

    function drawSpeedometer(){ drawGauge(spdCtx, state.speed, 180, state.lightsOn? 'km/h':'KM/H', state.lightsOn); }
    function drawTachometer(){ drawGauge(rpmCtx, state.rpm, 8000, state.lightsOn? 'rpm':'RPM', state.lightsOn); }

    function engineAnimationLoop(){
      // Dinâmica simples de aceleração/frenagem
      if (state.accelerating && state.speed < 180) state.speed += 1.8; else if (!state.accelerating && state.speed > 0) state.speed -= 0.9;
      state.speed = Math.max(0, Math.min(180, state.speed));
      state.rpm = Math.max(800, Math.min(8000, 600 + state.speed*40 + (state.accelerating? 300*Math.sin(Date.now()/120): 0)));
      // som
      sounds.engineLoop.playbackRate = 0.5 + (state.rpm / 9000);
      // desenhar
      drawSpeedometer(); drawTachometer();
      requestAnimationFrame(engineAnimationLoop);
    }

    // === Eventos ===
    carKey.addEventListener('click', startExperience);
    radioButtons.forEach(btn=> btn.addEventListener('click', ()=> changeEra(btn.dataset.era)) );
    gloveBoxHandle.addEventListener('click', showFunFact);
    logbookTrigger.addEventListener('click', showLogbook);
    exploreMuseumBtn.addEventListener('click', transitionToMuseum);
    hornBtn.addEventListener('click', ()=> playSound(sounds.horn));
    headlightBtn.addEventListener('click', ()=>{ toggleLightMode(); state.accelerating = !state.accelerating; });

    storyCards.forEach(card=>{
      card.querySelector('.card-details-btn').addEventListener('click', (e)=>{ e.stopPropagation(); showLightbox(card.dataset.title, card.dataset.text, card.dataset.img); });
    });

    engineHotspots.forEach(h=> h.addEventListener('click', (e)=>{ const imgSrc = e.currentTarget.closest('.engine-container').querySelector('.engine-image').src; showLightbox(h.dataset.title, h.dataset.text, imgSrc); }) );

    mapMarkers.forEach(m=> m.addEventListener('click', showMapInfo));
    document.querySelectorAll('[data-close]').forEach(btn=> btn.addEventListener('click', closeModal));

    // Inicialização: desenhar instrumentos no 0
    drawSpeedometer(); drawTachometer();
  });
  </script>
</body>
</html>
